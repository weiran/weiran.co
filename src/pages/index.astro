---
import { getCollection } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import Bio from '../components/Bio.astro'
import TitleLink from '../components/TitleLink.astro'
import { site } from '../config/site'
import { excerpt, formatDate } from '../lib/text'

const postsPerPage = 12

const posts = (await getCollection('blog'))
  .filter((p) => p.data.type !== 'page' && !p.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())

const pagePosts = posts.slice(0, postsPerPage)
const numPages = Math.ceil(posts.length / postsPerPage)
---

<BaseLayout description={site.description}>
  <Bio />
  <hr class="divider divider--xl" />

  {pagePosts.map((post) => (
    <article class="post-preview">
      <h2 class:list={['post-title', post.data.passthroughUrl ? 'post-title--link' : null]}>
        <TitleLink title={post.data.title} passthroughUrl={post.data.passthroughUrl} slug={post.slug} />
      </h2>
      <p class:list={['post-meta', post.data.passthroughUrl ? 'post-meta--link' : 'post-meta--list']}>
        {formatDate(post.data.date)}
      </p>
      <div class="post-preview-body">
        <p class="post-excerpt">{excerpt(post.body)}</p>
        <p>
          <a href={`/blog/${post.slug}`}>⌘</a>
        </p>
        <hr class="divider divider--xl divider--post" />
      </div>
    </article>
  ))}

  {numPages > 1 ? (
    <ul class="pager">
      <li></li>
      <li>
        <a href="/blog/page/2" rel="next">
          Next Page →
        </a>
      </li>
    </ul>
  ) : null}
</BaseLayout>
